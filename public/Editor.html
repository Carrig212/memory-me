<!DOCTYPE html>
<html >
<head>
  <meta charset="UTF-8">
  <title>Memory/Me</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src = "https://www.gstatic.com/firebasejs/4.6.2/firebase-app.js"></script>
  <script src = "https://www.gstatic.com/firebasejs/4.6.2/firebase-auth.js"></script>
  <script src = "https://www.gstatic.com/firebasejs/4.6.2/firebase-database.js"></script>
  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <link rel="stylesheet" href="css/index.css" type="text/css" />
  <link rel="shortcut icon" href="img/membrain.ico">
  <link href="https://cdn.quilljs.com/1.3.4/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.quilljs.com/1.3.4/quill.js"></script>

</head>

  <header class="headerhome">
    <nav>
        <ul>
          <li><a href = "index.html">Home</a></li>
          <li><a href ="Calendar.html">Calendar</a></li>
          <li class = "active"><a href="Editor.html">Diary</a></li>
          <li><a href = "Logger.html">Join</a></li>
        </ul>
    </nav>
  </header>
  <body id = "edBody">
    <h2>Welcome to your diary</h2>
    <!-- Create the editor container -->
    <div class = "editBlock" id = "editor">

    </div>

    <button id = "submitBtn">Save</button>

    <article class = "bottomContent">
      <h2>Previous entries:</h2>
      <footer>
        <p class = "post-info" id = "notLog"></p>
      </footer>
      <div id = "prevEntries">

      </div>
    </article>
    <!-- Initialize Quill editor -->
  <script>

  var toolbarOptions = [
    ['bold', 'italic', 'underline', 'strike'],        // toggled buttons
    ['blockquote', 'code-block'],

    [{ 'header': 1 }, { 'header': 2 }],               // custom button values
    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
    //[{ 'script': 'sub'}, { 'script': 'super' }],      // superscript/subscript
    //[{ 'indent': '-1'}, { 'indent': '+1' }],          // outdent/indent
    [{ 'direction': 'rtl' }],                         // text direction

    //[{ 'size': ['small', false, 'large', 'huge'] }],  // custom dropdown
    //[{ 'header': [1, 2, 3, 4, 5, 6, false] }],

    [{ 'color': [] }, { 'background': [] }],          // dropdown with defaults from theme
    [{ 'font': [] }],
    [{ 'align': [] }],

    ['clean']                                         // remove formatting button
  ];


    var quill = new Quill('#editor', {
      modules: {
          toolbar: toolbarOptions
      },
      theme: 'snow',
      placeholder: 'Make a new entry...'
    });
  </script>
  <script>
  const config = {
    apiKey: "AIzaSyC1g8NJiXRtNZUeZoVEx6RYKg-KikYsqns",
    authDomain: "memoryme-js.firebaseapp.com",
    databaseURL: "https://memoryme-js.firebaseio.com",
    projectId: "memoryme-js",
    storageBucket: "memoryme-js.appspot.com",
    messagingSenderId: "609070950026"
  };
  firebase.initializeApp(config);

  //document.getElementById("myFrame").onload = function() {refreshFunc()};


  var x = localStorage.getItem("user");
  //x=JSON.stringify(x);
  alert(x);

  var edrootRef = firebase.database().ref().child(x+'/diaryPage');

  var Delta =  Quill.import('delta');
  var change = new Delta();
  quill.on('text-change',function(delta){
    change=change.compose(delta);
  });

  $('#submitBtn').click(function(){
    if(x=='"default"'){
      alert("You are currently not signed in, anything you enter will not be saved. Please visit the join page.")
    }else if(quill.getLength()!=1){
      edrootRef.push({
        diary: JSON.stringify(change)
      });
      quill.setText('');
    }else if(quill.getLength()==1){
      alert("Diary entry is empty, please write a new entry before saving.");
    }
  })


  if(x=='"default"'){
    document.getElementById('notLog').innerHTML="Please join us and log in to start your story and see your previous entries.";
  }else{
    edrootRef.on("value", function(snapshot) {
       console.log(snapshot.val());
       document.getElementById('notLog').innerHTML= JSON.stringify(snapshot.val());
    }, function (error) {
       console.log("Error: " + error.code);
    });
  }
  </script>
  </body>
</html>
